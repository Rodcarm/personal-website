name: Run File Changes Json
on:
  push:
    branches:
      - test
    paths:
      - 'files/new-files/deploy.json'
jobs:
  file-update-controller:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Get Var
        run: |
          commit_message=$(jq -r ".commit_message" files/new-files/deploy.json)
          echo "commit_message=${commit_message}" >> $GITHUB_ENV
          echo "USER_COMMIT=${{ github.actor }}" >> $GITHUB_ENV
          echo "EMAIL=${{ github.event.head_commit.author.email }}" >> $GITHUB_ENV
          
      - name: Update json file
        run: |
          new_author="${{ env.EMAIL }}"
          jq --arg author "$new_author" '.author = $author' files/new-files/deploy.json > files/new-files/deploy_temp.json && mv files/new-files/deploy_temp.json files/new-files/deploy.json
          jq '.' files/new-files/deploy.json
      - name: Push file to another repository
        uses: nkoppel/push-files-to-another-repository@v1.1.3
        env:
          API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
          USER_COMMIT: ${{ env.USER_COMMIT }} 
          EMAIL: ${{ env.EMAIL }}
          COMMIT_MESSAGE: ${{ env.commit_message }}
        with:
          source-files: './files/new-files/deploy.json'
          destination-branch: 'main'
          destination-username: 'Rodcarm'
          destination-repository: 'controller'
          destination-directory: 'files/new-files/'
          commit-email: "${{ env.USER_COMMIT }}"
          commit-username: "${{ env.EMAIL }}"
          commit-message: "${{ env.commit_message }}"



# name: Run File Changes
# on:
#   push:
#     branches:
#       - main
#     # paths:
#     #   - 'archivesToTest.txt'
#       #- 'webpersonal/core/views.py'
# jobs:
#   file-update-job:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Push file to another repository
#         uses: nkoppel/push-files-to-another-repository@v1.1.3
#         env:
#           API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
#         with:
#           source-files: './files/new-files/archivesToTest.txt'
#           destination-branch: 'main'
#           destination-username: 'Rodcarm'
#           destination-repository: 'controller'
#           destination-directory: 'files/new-files/test.txt'
#           commit-email: rcarmona@realmetrics.io